<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>implementations | CAI</title>
  <meta name="description" content="practical implementations of CAI. copyable code, drop in hooks, scoring, gating, logging, and evaluation." />
  <link rel="icon" href="assets/favicon.png" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="canonical" href="https://www.compressionawareintelligence.com/implementations.html" />
  <meta property="og:title" content="implementations | compression aware intelligence" />
  <meta property="og:description" content="how to ship CAI this week. quick start, scoring, gating policy, api, logging schema, and evaluation harness." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.compressionawareintelligence.com/implementations.html" />
  <meta name="twitter:card" content="summary" />

  <!-- MathJax for equations where needed -->
  <script>
    window.MathJax = { tex: { inlineMath: [['$','$'], ['\\(','\\)']] }, options:{skipHtmlTags:['script','noscript','style','textarea','pre','code']} };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    /* light local helpers that play nice with styles.css */
    .pill-nav{display:flex;flex-wrap:wrap;gap:.5rem;margin:.5rem 0 1rem}
    .pill-nav a{border:1px solid var(--ink,#111);padding:.35rem .65rem;border-radius:999px;text-decoration:none}
    .grid{display:grid;gap:1rem}
    .two{grid-template-columns:repeat(2,minmax(0,1fr))}
    .three{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media(max-width:980px){.two,.three{grid-template-columns:1fr}}
    .muted{opacity:.85}
    .small{font-size:.9rem}
    .eq{background:#f9fafb;border-left:3px solid var(--ink,#111);padding:.75rem 1rem;border-radius:8px;overflow:auto}
    pre{background:#0f172a;color:#e2e8f0;padding:1rem;border-radius:10px;overflow:auto}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .table{width:100%;border-collapse:collapse;font-size:.95rem}
    .table th,.table td{border-bottom:1px solid rgba(0,0,0,.08);padding:.5rem .4rem;text-align:left}
    .cta{display:flex;gap:.75rem;flex-wrap:wrap;margin-top:.5rem}
    .button{display:inline-block;border:1px solid var(--ink,#111);padding:.5rem .8rem;border-radius:10px;text-decoration:none}
    .copy-btn{font:inherit;border:1px solid var(--ink,#111);background:transparent;padding:.35rem .65rem;border-radius:.5rem;cursor:pointer}
    mjx-container{display:block;overflow-x:auto;overflow-y:hidden}
  </style>
</head>
<body>

<header class="site-header">
  <a class="brand" href="index.html"><span class="logo"></span><span>CAI</span></a>
  <nav class="nav">
    <a href="index.html" data-nav>Home</a>
    <a href="coherencefield.html" data-nav>The Coherence Field</a>
    <a href="proof.html" data-nav>Proof</a>
    <a href="principles.html" data-nav>Principles</a>
    <a href="applications.html" data-nav>Applications</a>
    <a href="contradictions.html" data-nav>Contradictions</a>
    <a href="implementations.html" data-nav>Implementations</a>
    <a href="glossary.html" data-nav>Glossary</a>
    <a href="faq.html" data-nav>FAQ</a>
    <a href="about.html" data-nav>About</a>
    <a href="contact.html" data-nav>Contact</a>
  </nav>
</header>

<main class="wrap" id="main">
  <section class="hero card">
    <p class="pill">engineer hub</p>
    <h1>implementations</h1>
    <p class="lede">ship CAI this week. copy the quick start, wire the scoring and gating hooks, log receipts, and measure outcomes.</p>

    <nav class="pill-nav" aria-label="sections">
      <a href="#quickstart">quick start</a>
      <a href="#scoring">scoring</a>
      <a href="#gating">gating policy</a>
      <a href="#api">reference service</a>
      <a href="#logging">logging schema</a>
      <a href="#patterns">integration patterns</a>
      <a href="#evaluation">evaluation harness</a>
      <a href="#checklist">checklist</a>
    </nav>
  </section>

  <!-- quick start -->
  <section id="quickstart" class="card">
    <h2>quick start in 30 lines</h2>
    <p class="muted small">toy but real. you can swap in your own models. this shows per site scoring and abstention with receipts.</p>
<pre id="qs-python"><code class="small"># pip install numpy regex
import re, json, math, numpy as np

STOP = set("the a an and or of for in on to is are was were be been being with by as at from this that it".split())

def toks(s): return re.findall(r"[a-z0-9']+", s.lower())
def compress_ratio(t):
    b = t.encode(); return len(b) / (len(set(b)) + 1)
def delta_pred_loss(t):
    base = compress_ratio(t)
    content = " ".join([w for w in toks(t) if w not in STOP])
    simp = compress_ratio(content)
    d = max(0.0, base - simp)
    return max(0.0, min(1.0, d/2.0))
def kl_proxy(t):
    w = toks(t); 
    return 0.0 if not w else max(0.0, min(1.0, sum(len(x)&gt;8 for x in w)/len(w)))
def residual(t):
    r = compress_ratio(t); return max(0.0, min(1.0, 1.0/(r or 1e-6)))

def S_score(text):
    d,k,e = delta_pred_loss(text), kl_proxy(text), residual(text)
    S = max(0.0, min(1.0, 0.5*d + 0.25*k + 0.25*e))
    return {"delta_pred":d, "kl":k, "residual":e, "S":S}

def nli_heuristic(text):
    sents = re.split(r"(?&lt;=[.!?])\s+", text.strip()); sents = [s for s in sents if s]
    def neg(s): return re.search(r"(^|\s)(not|never|no|none|cannot|isn't|can't)(\s|$)", s, re.I) is not None
    def terms(s): return set([w for w in toks(s) if w not in STOP and len(w)&gt;3])
    scores = []
    for i in range(len(sents)):
        for j in range(i+1, len(sents)):
            A,B = terms(sents[i]), terms(sents[j])
            inter = len(A & B); uni = len(A | B) or 1
            overlap = inter/uni; flip = 1 if (neg(sents[i]) ^ neg(sents[j])) else 0
            scores.append(overlap*flip)
    m = np.mean(scores) if scores else 0.0
    return max(0.0, min(1.0, m/0.6))

def coverage(text, source):
    T, S = set(toks(text)), set(toks(source))
    inter = len(T & S); uni = len(T | S) or 1
    return inter/uni

def C_score(text, sources):
    nli = nli_heuristic(text)
    gap = 1.0 - max([coverage(text, s) for s in sources] or [0.0])
    unsat = 0.0  # placeholder
    C = max(0.0, min(1.0, 0.5*nli + 0.25*unsat + 0.25*gap))
    return {"nli":nli, "unsat":unsat, "halluc_risk":gap, "C":C}

def decide(text, sources, tau=0.7):
    S, C = S_score(text), C_score(text, sources)
    CTS = S["S"] * C["C"]
    ok = CTS &lt;= tau
    return {"S":S,"C":C,"CTS":CTS,"ok":ok,"provenance":sources}

print(json.dumps(decide("Paris is the capital of France. Paris is not the capital of France.", ["france gov site"]), indent=2))</code></pre>
    <div class="cta">
      <button class="copy-btn" data-copy="#qs-python">copy code</button>
      <a class="button" href="#evaluation">see evaluation</a>
    </div>
  </section>

  <!-- scoring -->
  <section id="scoring" class="card">
    <h2>scoring</h2>
    <div class="eq">compression strain
      $$ S = w_1\\,\\Delta L_{pred} + w_2\\,\\mathrm{KL}\\big(q(z\\mid x)\\Vert p(z)\\big) + w_3\\,E_{res} \\in [0,1] $$
    </div>
    <div class="eq" style="margin-top:.5rem">contradiction magnitude
      $$ C = a\\,\\overline{P_{NLI}(contr)} + b\\,U_{SAT} + c\\,H_{halluc} \\in [0,1] $$
    </div>
    <div class="eq" style="margin-top:.5rem">tension
      $$ CTS = S \\cdot C $$
    </div>
    <p class="small muted">start with equal weights, then learn weights on your validation sets.</p>
  </section>

  <!-- gating policy -->
  <section id="gating" class="card">
    <h2>gating policy</h2>
    <p>block unsupported claims when $CTS$ passes a threshold. request evidence or abstain. tune the threshold to your harm profile.</p>
<pre id="gating-yaml"><code>gating_policy:
  tau_star: 0.70
  abstain_if:
    - "no_entailment"
    - "CTS &gt; tau_star"
  on_abstain:
    - "ask_for_source"
    - "increase_retrieval_weight"
    - "lower_temperature"</code></pre>
    <button class="copy-btn" data-copy="#gating-yaml">copy yaml</button>
  </section>

  <!-- reference service -->
  <section id="api" class="card">
    <h2>reference service</h2>
    <div class="grid two">
      <div>
        <h3>install and run</h3>
<pre id="api-install"><code class="small">pip install fastapi uvicorn pydantic python-multipart
# optional
pip install transformers torch python-sat
uvicorn cstc_service:app --reload</code></pre>
        <button class="copy-btn" data-copy="#api-install">copy install</button>
      </div>
      <div>
        <h3>endpoints</h3>
        <table class="table small">
          <thead><tr><th>method</th><th>path</th><th>body</th><th>returns</th></tr></thead>
          <tbody>
            <tr><td>POST</td><td><code>/compute</code></td><td><code>{ text, sources[], constraints[][] }</code></td><td>S, C, CTS, receipts</td></tr>
            <tr><td>POST</td><td><code>/train/cac</code></td><td><code>{ features[], target_cts }</code></td><td>head weights</td></tr>
            <tr><td>GET</td><td><code>/health</code></td><td>none</td><td>status</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="grid two" style="margin-top:1rem">
      <div>
<pre id="api-client-py"><code class="small">import requests, json
payload = {"text":"A is B. A is not B.","sources":["doc a","doc b"],"constraints":[]}
r = requests.post("http://127.0.0.1:8000/compute", json=payload)
print(json.dumps(r.json(), indent=2))</code></pre>
        <button class="copy-btn" data-copy="#api-client-py">copy python client</button>
      </div>
      <div>
<pre id="api-client-js"><code class="small">const res = await fetch("/compute",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({text, sources, constraints:[]})
});
const data = await res.json(); console.log(data);</code></pre>
        <button class="copy-btn" data-copy="#api-client-js">copy js client</button>
      </div>
    </div>
  </section>

  <!-- logging schema -->
  <section id="logging" class="card">
    <h2>logging schema</h2>
    <p class="small muted">log tension, not secrets. you can redact raw content and still keep audit power.</p>
<pre id="log-json"><code>{
  "request_id": "uuid",
  "timestamp": "2025-10-30T16:00:00Z",
  "user_role": "agent",
  "sites": [
    {"name":"retrieve","S":0.18,"C":0.22,"CTS":0.04,"provenance":["doc_a_id","doc_b_id"]},
    {"name":"summarize","S":0.31,"C":0.35,"CTS":0.11,"provenance":["doc_a_id"]},
    {"name":"generate","S":0.27,"C":0.41,"CTS":0.11,"provenance":["doc_a_id"]}
  ],
  "path_scores":{"S":0.27,"C":0.33,"CTS":0.09},
  "decision":{"abstained":false,"reason":null,"tau_star":0.70},
  "redaction":{"raw_text_logged":false,"token_count":224}
}</code></pre>
    <button class="copy-btn" data-copy="#log-json">copy schema</button>
  </section>

  <!-- integration patterns -->
  <section id="patterns" class="card">
    <h2>integration patterns</h2>
    <div class="grid three">
      <div class="card">
        <h3>rag governance</h3>
        <ul>
          <li>score S and C at retrieve and summarize</li>
          <li>penalize contradictory sources in rank</li>
          <li>attach receipts in final answer</li>
        </ul>
<pre id="rag-yaml"><code>rag_cai:
  budget:
    tokens_max: 2200
    tau_target: 0.45
  ranker_prefer: ["high_provenance","low_contradiction"]
  summarizer_objective: "minimize_tau_equal_accuracy"</code></pre>
        <button class="copy-btn" data-copy="#rag-yaml">copy config</button>
      </div>
      <div class="card">
        <h3>agent loop</h3>
        <ul>
          <li>compute CTS before tool call</li>
          <li>if CTS high then clarify or fetch more sources</li>
          <li>log per step receipts</li>
        </ul>
<pre id="agent-py"><code class="small">if CTS &gt; tau_star:
  plan = "ask user for evidence or fetch more docs"
else:
  plan = "proceed with tool call"</code></pre>
        <button class="copy-btn" data-copy="#agent-py">copy snippet</button>
      </div>
      <div class="card">
        <h3>batch etl</h3>
        <ul>
          <li>score existing outputs</li>
          <li>tag high CTS items for review</li>
          <li>auto fix if new sources reduce C</li>
        </ul>
<pre id="etl-sql"><code class="small">-- pseudo
select id, text, CTS from outputs where CTS &gt; 0.7 order by CTS desc;</code></pre>
        <button class="copy-btn" data-copy="#etl-sql">copy query</button>
      </div>
    </div>
  </section>

  <!-- evaluation harness -->
  <section id="evaluation" class="card">
    <h2>evaluation harness</h2>
    <p class="muted">report these side by side for baseline and CAI gated runs</p>
    <table class="table" aria-describedby="eval-desc">
      <caption id="eval-desc" class="small muted">use the benchmarks page for tasks and a scorecard template</caption>
      <thead><tr><th>metric</th><th>baseline</th><th>cai gated</th><th>target</th></tr></thead>
      <tbody>
        <tr><td>unsupported claim rate</td><td>—</td><td>—</td><td>less than or equal to baseline</td></tr>
        <tr><td>task accuracy</td><td>—</td><td>—</td><td>maintain or improve</td></tr>
        <tr><td>abstention rate</td><td>—</td><td>—</td><td>calibrated at tau*</td></tr>
        <tr><td>mean time to review</td><td>—</td><td>—</td><td>decrease</td></tr>
      </tbody>
    </table>
    <div class="cta">
      <a class="button" href="benchmarks.html">open benchmarks</a>
      <a class="button" href="foundations.html">see equations</a>
    </div>
  </section>

  <!-- checklist -->
  <section id="checklist" class="card">
    <h2>implementation checklist</h2>
<pre id="checklist-yaml"><code>cai_impl_checklist:
  compression_sites_listed: false
  tau_per_site_computed: false
  provenance_attached: false
  tau_star_set: false
  contradiction_detector_wired: false
  abstention_policy_enabled: false
  logs_written_without_raw_text: false
  outcome_metrics_tracked: false</code></pre>
    <button class="copy-btn" data-copy="#checklist-yaml">copy checklist</button>
    <p class="muted small">privacy by design: log ids and scores, not raw secrets. keep receipts minimal but sufficient for audit.</p>
  </section>

  <section class="card" aria-live="polite">
    <p class="muted small"><small>last updated: <time id="last-updated"></time></small></p>
  </section>
</main>

<footer class="site-footer">
  <small>© <span id="year"></span> Compression-Aware Intelligence. see also
    <a href="https://www.contradictionengineering.com" target="_blank" rel="noopener">Contradiction Engineering</a>
  </small>
</footer>

<script>
  // dates
  const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();
  const lu = document.getElementById('last-updated'); if (lu) lu.textContent = new Date().toISOString().slice(0,10);

  // copy helpers
  document.querySelectorAll('.copy-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const target = document.querySelector(btn.dataset.copy);
      if (!target) return;
      const text = target.innerText;
      navigator.clipboard.writeText(text).then(()=>{
        const old = btn.textContent;
        btn.textContent = 'copied';
        setTimeout(()=>btn.textContent = old, 1400);
      });
    });
  });
</script>
</body>
</html>
